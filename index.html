<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>R&D Portfolio Analysis â€” Why Alpha Decayed After 2000</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=DM+Mono:wght@400;500&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: #0c0e14; font-family: 'DM Sans', sans-serif; color: #e2e6f0; }
    button { font-family: inherit; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #13161f; }
    ::-webkit-scrollbar-thumb { background: #252a38; border-radius: 3px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    // â”€â”€â”€ REGRESSION DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Structure: REGS[sample][weighting][model][period][portfolio]
    // sample:    "all" | "filtered"
    // weighting: "EW"  | "VW"
    // model:     "CAPM"| "FF3"
    // period:    "1980-2000" | "2001-2022"
    // portfolio: "Q5-Q1" | "Q5-Zero"

    const REGS = {
      all: {
        EW: {
          CAPM: {
            "1980â€“2000": {
              "Q5-Q1":   { alpha: 2.0422, t: 4.9174, p: 0.0000, sharpe: 1.3172, betaMkt: -0.0312,                                       r2: 0.0006 },
              "Q5-Zero": { alpha: 1.4245, t: 2.9785, p: 0.0033, sharpe: 0.9216, betaMkt:  0.2828,                                       r2: 0.0375 },
            },
            "2001â€“2022": {
              "Q5-Q1":   { alpha: 0.7948, t: 2.2211, p: 0.0276, sharpe: 0.6898, betaMkt:  0.3150,                                       r2: 0.0854 },
              "Q5-Zero": { alpha: 0.4203, t: 1.1301, p: 0.2599, sharpe: 0.4152, betaMkt:  0.3106,                                       r2: 0.0775 },
            },
          },
          FF3: {
            "1980â€“2000": {
              "Q5-Q1":   { alpha: 2.0166, t: 6.0823, p: 0.0000, sharpe: 1.3172, betaMkt: -0.0765, betaSmb:  1.0375, betaHml:  0.2028, r2: 0.4091 },
              "Q5-Zero": { alpha: 1.7259, t: 4.9788, p: 0.0000, sharpe: 0.9216, betaMkt:  0.0308, betaSmb:  1.0999, betaHml: -0.3333, r2: 0.5309 },
            },
            "2001â€“2022": {
              "Q5-Q1":   { alpha: 0.7589, t: 2.1966, p: 0.0293, sharpe: 0.6898, betaMkt:  0.2139, betaSmb:  0.5673, betaHml:  0.0037, r2: 0.1613 },
              "Q5-Zero": { alpha: 0.5291, t: 1.6174, p: 0.1075, sharpe: 0.4152, betaMkt:  0.2345, betaSmb:  0.5379, betaHml: -0.6290, r2: 0.2980 },
            },
          },
        },
        VW: {
          CAPM: {
            "1980â€“2000": {
              "Q5-Q1":   { alpha: 0.3785, t: 1.0304, p: 0.3043, sharpe: 0.2659, betaMkt: -0.0226,                                       r2: 0.0004 },
              "Q5-Zero": { alpha: 0.3939, t: 1.1801, p: 0.2396, sharpe: 0.4262, betaMkt:  0.1685,                                       r2: 0.0276 },
            },
            "2001â€“2022": {
              "Q5-Q1":   { alpha: 0.1412, t: 0.3625, p: 0.7174, sharpe: 0.2920, betaMkt:  0.5295,                                       r2: 0.1821 },
              "Q5-Zero": { alpha:-0.1059, t:-0.3280, p: 0.7433, sharpe: 0.1829, betaMkt:  0.5727,                                       r2: 0.2749 },
            },
          },
          FF3: {
            "1980â€“2000": {
              "Q5-Q1":   { alpha: 0.0721, t: 0.2080, p: 0.8355, sharpe: 0.2659, betaMkt:  0.1296, betaSmb:  0.6453, betaHml:  0.6108, r2: 0.1736 },
              "Q5-Zero": { alpha: 0.4690, t: 1.4986, p: 0.1359, sharpe: 0.4262, betaMkt:  0.0922, betaSmb:  0.5027, betaHml: -0.0478, r2: 0.2070 },
            },
            "2001â€“2022": {
              "Q5-Q1":   { alpha:-0.0575, t:-0.1719, p: 0.8637, sharpe: 0.2920, betaMkt:  0.3820, betaSmb:  0.7077, betaHml:  0.6866, r2: 0.4064 },
              "Q5-Zero": { alpha:-0.1954, t:-0.6414, p: 0.5221, sharpe: 0.1829, betaMkt:  0.4672, betaSmb:  0.5495, betaHml:  0.2460, r2: 0.3650 },
            },
          },
        },
      },
      filtered: {
        EW: {
          CAPM: {
            "1980â€“2000": {
              "Q5-Q1":   { alpha: 1.1273, t: 2.5524, p: 0.0116, sharpe: 0.7276, betaMkt:  0.0719,                                       r2: 0.0029 },
              "Q5-Zero": { alpha: 0.7274, t: 1.3451, p: 0.1804, sharpe: 0.5121, betaMkt:  0.3953,                                       r2: 0.0562 },
            },
            "2001â€“2022": {
              "Q5-Q1":   { alpha: 0.6038, t: 1.7794, p: 0.0768, sharpe: 0.5724, betaMkt:  0.2720,                                       r2: 0.0718 },
              "Q5-Zero": { alpha: 0.3361, t: 0.9074, p: 0.3654, sharpe: 0.3636, betaMkt:  0.3194,                                       r2: 0.0822 },
            },
          },
          FF3: {
            "1980â€“2000": {
              "Q5-Q1":   { alpha: 1.1325, t: 3.0499, p: 0.0027, sharpe: 0.7276, betaMkt:  0.0100, betaSmb:  0.9958, betaHml:  0.1449, r2: 0.3462 },
              "Q5-Zero": { alpha: 1.1630, t: 3.0175, p: 0.0029, sharpe: 0.5121, betaMkt:  0.0553, betaSmb:  1.1790, betaHml: -0.5451, r2: 0.5552 },
            },
            "2001â€“2022": {
              "Q5-Q1":   { alpha: 0.5584, t: 1.6980, p: 0.0912, sharpe: 0.5724, betaMkt:  0.1790, betaSmb:  0.5114, betaHml:  0.0609, r2: 0.1424 },
              "Q5-Zero": { alpha: 0.4394, t: 1.3341, p: 0.1839, sharpe: 0.3636, betaMkt:  0.2449, betaSmb:  0.5240, betaHml: -0.6006, r2: 0.2863 },
            },
          },
        },
        VW: {
          CAPM: {
            "1980â€“2000": {
              "Q5-Q1":   { alpha: 0.6884, t: 1.8715, p: 0.0630, sharpe: 0.4998, betaMkt: -0.0131,                                       r2: 0.0001 },
              "Q5-Zero": { alpha: 0.5770, t: 1.2904, p: 0.1987, sharpe: 0.4895, betaMkt:  0.3064,                                       r2: 0.0497 },
            },
            "2001â€“2022": {
              "Q5-Q1":   { alpha: 0.4816, t: 1.2373, p: 0.2176, sharpe: 0.4599, betaMkt:  0.3859,                                       r2: 0.1058 },
              "Q5-Zero": { alpha: 0.3092, t: 0.8312, p: 0.4070, sharpe: 0.4026, betaMkt:  0.5105,                                       r2: 0.1849 },
            },
          },
          FF3: {
            "1980â€“2000": {
              "Q5-Q1":   { alpha: 0.5653, t: 1.6688, p: 0.0970, sharpe: 0.4998, betaMkt:  0.0215, betaSmb:  0.7094, betaHml:  0.3148, r2: 0.2134 },
              "Q5-Zero": { alpha: 0.8748, t: 2.5617, p: 0.0113, sharpe: 0.4895, betaMkt:  0.0658, betaSmb:  0.9446, betaHml: -0.3513, r2: 0.4858 },
            },
            "2001â€“2022": {
              "Q5-Q1":   { alpha: 0.3304, t: 0.9110, p: 0.3635, sharpe: 0.4599, betaMkt:  0.3011, betaSmb:  0.3764, betaHml:  0.5669, r2: 0.2365 },
              "Q5-Zero": { alpha: 0.2955, t: 0.8016, p: 0.4239, sharpe: 0.4026, betaMkt:  0.4453, betaSmb:  0.3739, betaHml: -0.0413, r2: 0.2130 },
            },
          },
        },
      },
    };

    // â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    const SIZE_DIST = {
      "1980â€“2000": {
        Q5: [29.5, 35.1, 20.3, 9.0, 4.7, 1.4],
        Q1: [10.8, 26.4, 24.3, 21.3, 11.3, 5.8],
      },
      "2001â€“2022": {
        Q5: [11.1, 31.6, 29.5, 19.8, 6.0, 2.0],
        Q1: [1.1,  8.4,  14.3, 25.8, 26.3, 24.2],
      },
    };
    const SIZE_LABELS = ["<$10M", "$10â€“50M", "$50â€“200M", "$200Mâ€“1B", "$1â€“5B", ">$5B"];

    const SIC_DATA = {
      Q5: [
        { sic: 36, name: "Electronic Equipment",  nFirms: 465, pct: 19.8, ret: 2.64, me:   21.5 },
        { sic: 35, name: "Machinery/Computers",   nFirms: 443, pct: 18.8, ret: 1.89, me:   29.4 },
        { sic: 73, name: "Business Services",     nFirms: 381, pct: 16.2, ret: 3.66, me:   28.0 },
        { sic: 38, name: "Instruments",           nFirms: 376, pct: 16.0, ret: 2.72, me:   18.8 },
        { sic: 28, name: "Chemicals",             nFirms: 200, pct:  8.5, ret: 3.99, me:   41.1 },
        { sic: 87, name: "Engineering Services",  nFirms:  45, pct:  1.9, ret: 6.84, me:   30.6 },
        { sic: 37, name: "Transportation Equip",  nFirms:  59, pct:  2.5, ret: 1.95, me: 1543.4 },
        { sic: 30, name: "Rubber/Plastics",       nFirms:  36, pct:  1.5, ret: 2.17, me:   60.9 },
      ],
      Q1: [
        { sic: 73, name: "Business Services",     nFirms: 516, pct: 17.0, ret:  0.90, me: 149.3 },
        { sic: 36, name: "Electronic Equipment",  nFirms: 425, pct: 14.0, ret:  0.64, me:  60.9 },
        { sic: 35, name: "Machinery/Computers",   nFirms: 332, pct: 11.0, ret: -0.05, me:  73.8 },
        { sic: 38, name: "Instruments",           nFirms: 278, pct:  9.2, ret:  0.18, me:  54.6 },
        { sic: 28, name: "Chemicals",             nFirms: 191, pct:  6.3, ret:  0.80, me:  86.2 },
        { sic: 34, name: "Fabricated Metals",     nFirms: 104, pct:  3.4, ret:  1.01, me: 104.8 },
        { sic: 20, name: "Food Products",         nFirms:  79, pct:  2.6, ret:  0.98, me: 561.4 },
        { sic: 30, name: "Rubber/Plastics",       nFirms:  66, pct:  2.2, ret:  0.88, me:  64.6 },
      ],
    };

    const PERIOD_STATS = {
      "1980â€“2000": {
        nFirms: 2112, meanME: 439.7, medianME: 25.2,
        pctMicro: 64.6, avgRet: 2.70,
        topInds: [{ name: "Manufacturing", n: 1649 }, { name: "Services", n: 456 }, { name: "Other", n: 46 }],
      },
      "2001â€“2022": {
        nFirms: 1966, meanME: 667.1, medianME: 69.4,
        pctMicro: 42.8, avgRet: 1.75,
        topInds: [{ name: "Manufacturing", n: 966 }, { name: "Services", n: 555 }, { name: "Public Admin", n: 393 }],
      },
    };

    // â”€â”€â”€ COLOURS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    const C = {
      bg:      "#0c0e14",
      surface: "#13161f",
      card:    "#191d28",
      border:  "#252a38",
      accent1: "#e8c96d",
      accent2: "#5b9cf6",
      accent3: "#ef7c5b",
      muted:   "#5a6070",
      text:    "#e2e6f0",
      textDim: "#8a92a8",
    };

    const fmt = (n, dec = 1) => Number(n).toFixed(dec);

    // â”€â”€â”€ SHARED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function SectionTitle({ n, label, sub }) {
      return (
        <div style={{ marginBottom: 28 }}>
          <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 6 }}>
            <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.accent1, letterSpacing: "0.15em" }}>
              0{n}
            </span>
            <div style={{ flex: 1, height: 1, background: C.border }} />
          </div>
          <h2 style={{ fontFamily: "'Playfair Display', serif", fontSize: 22, color: C.text, margin: 0, fontWeight: 700 }}>
            {label}
          </h2>
          {sub && <p style={{ color: C.textDim, fontSize: 13, margin: "6px 0 0", lineHeight: 1.6 }}>{sub}</p>}
        </div>
      );
    }

    function Callout({ color, label, children }) {
      return (
        <div style={{
          marginTop: 16, padding: "14px 18px",
          background: color + "0f", border: `1px solid ${color}30`,
          borderRadius: 6, fontSize: 13, color: C.textDim, lineHeight: 1.75,
        }}>
          {label && <span style={{ color, fontWeight: 700 }}>{label} </span>}
          {children}
        </div>
      );
    }

    function Toggle({ options, value, onChange }) {
      return (
        <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
          {options.map(([val, lbl, col]) => {
            const active = value === val;
            const c = col || C.accent1;
            return (
              <button key={val} onClick={() => onChange(val)} style={{
                padding: "6px 16px", borderRadius: 4, fontSize: 12, fontWeight: 600,
                cursor: "pointer", border: "1px solid",
                borderColor: active ? c : C.border,
                background: active ? c + "22" : "transparent",
                color: active ? c : C.textDim,
                letterSpacing: "0.04em",
              }}>{lbl || val}</button>
            );
          })}
        </div>
      );
    }

    // â”€â”€â”€ SECTION 2: SIZE DISTRIBUTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    const BUCKET_COLORS = ["#ef7c5b","#e8a06d","#e8c96d","#8fbf6a","#5b9cf6","#9b8bf5"];

    function SizeBar({ label, pct, color, maxPct }) {
      return (
        <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 9 }}>
          <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.textDim, width: 76, flexShrink: 0, textAlign: "right" }}>
            {label}
          </span>
          <div style={{ flex: 1, background: C.border, borderRadius: 2, height: 16, overflow: "hidden" }}>
            <div style={{
              width: `${(pct / maxPct) * 100}%`, height: "100%",
              background: color, borderRadius: 2,
              transition: "width 0.55s cubic-bezier(.4,0,.2,1)",
            }} />
          </div>
          <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.text, width: 42, textAlign: "right" }}>
            {fmt(pct)}%
          </span>
        </div>
      );
    }

    function SizeSection() {
      const [period, setPeriod] = useState("1980â€“2000");
      const data = SIZE_DIST[period];
      const maxPct = Math.max(...data.Q5, ...data.Q1);

      return (
        <div>
          <SectionTitle n={2} label="Size Distribution: Q5 vs Q1"
            sub="Firm-month distribution by market cap bucket, equal- and value-weighted portfolios, both subperiods." />

          <div style={{ marginBottom: 24 }}>
            <Toggle
              options={[["1980â€“2000", null, C.accent1], ["2001â€“2022", null, C.accent2]]}
              value={period}
              onChange={setPeriod}
            />
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(280px, 1fr))", gap: 20 }}>
            {[["Q5", "High R&D", C.accent1], ["Q1", "Low R&D", C.accent2]].map(([port, lbl, col]) => (
              <div key={port} style={{ background: C.card, border: `1px solid ${C.border}`, borderRadius: 8, padding: 20 }}>
                <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 18 }}>
                  <span style={{ fontFamily: "'Playfair Display', serif", fontSize: 16, fontWeight: 700, color: col }}>{port}</span>
                  <span style={{ color: C.textDim, fontSize: 12 }}>â€” {lbl}</span>
                </div>
                {SIZE_LABELS.map((l, i) => (
                  <SizeBar key={l} label={l} pct={data[port][i]} color={BUCKET_COLORS[i]} maxPct={maxPct} />
                ))}
              </div>
            ))}
          </div>

          <Callout color={C.accent1} label="Observations:">
            {period === "1980â€“2000"
              ? "Q5: 64.6% of firm-months below $50M. Q1: 37.2% below $50M, 17.1% above $1B. Substantial size divergence between portfolios."
              : "Q5: micro-cap share fell from 64.6% to 42.8%. Q1: shifted further upward â€” 50.5% now above $1B vs 17.1% in prior period. The gap between Q5 and Q1 size distributions widened in the later period."}
          </Callout>
        </div>
      );
    }

    // â”€â”€â”€ SECTIONS 4+5: SIC DRILL-DOWN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function SICSection() {
      const [port, setPort] = useState("Q5");
      const [sortBy, setSortBy] = useState("pct");

      const data = [...SIC_DATA[port]].sort((a, b) => b[sortBy] - a[sortBy]);
      const col  = port === "Q5" ? C.accent1 : C.accent2;
      const maxPct = 22;
      const maxRet = 7.5;

      const inBothSICs = new Set(
        SIC_DATA.Q5.map(d => d.sic).filter(s => SIC_DATA.Q1.some(d => d.sic === s))
      );

      return (
        <div>
          <SectionTitle n={3} label="Industry Composition: Q5 vs Q1 (1980â€“2000)"
            sub='Top 2-digit SIC industries by firm count, with average monthly return and median ME. "IN BOTH" marks industries present in both Q5 and Q1.' />

          <div style={{ display: "flex", gap: 8, marginBottom: 20, flexWrap: "wrap", alignItems: "center" }}>
            <Toggle
              options={[["Q5", "Q5 â€” High R&D", C.accent1], ["Q1", "Q1 â€” Low R&D", C.accent2]]}
              value={port}
              onChange={setPort}
            />
            <div style={{ flex: 1 }} />
            <span style={{ fontSize: 11, color: C.muted }}>Sort by:</span>
            <Toggle
              options={[["pct","% share",C.accent3],["ret","return",C.accent3],["me","median ME",C.accent3]]}
              value={sortBy}
              onChange={setSortBy}
            />
          </div>

          {/* Table header */}
          <div style={{ overflowX: "auto" }}><div style={{
            display: "grid", gridTemplateColumns: "36px 1fr 72px 155px 160px 88px", minWidth: "560px",
            gap: 10, paddingBottom: 8, marginBottom: 2,
            borderBottom: `1px solid ${C.border}`,
            fontSize: 10, color: C.muted, letterSpacing: "0.1em", textTransform: "uppercase",
            fontFamily: "'DM Mono', monospace",
          }}>
            <span>SIC</span><span>Industry</span>
            <span style={{ textAlign: "right" }}>Firms</span>
            <span>% of portfolio</span>
            <span>Avg return / mo</span>
            <span style={{ textAlign: "right" }}>Median ME</span>
          </div>

          {data.map(row => {
            const overlap = inBothSICs.has(row.sic);
            const retColor = row.ret > 3 ? "#5dba7a" : row.ret > 1.5 ? C.accent1 : row.ret < 0 ? C.accent3 : C.textDim;
            return (
              <div key={row.sic} style={{
                display: "grid", gridTemplateColumns: "36px 1fr 72px 155px 160px 88px",
                minWidth: "560px", gap: 10, padding: "10px 0",
                borderBottom: `1px solid ${C.border}22`,
                alignItems: "center",
              }}>
                <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 10, color: C.muted }}>{row.sic}</span>

                <div style={{ display: "flex", alignItems: "center", gap: 7 }}>
                  <span style={{ fontSize: 13, color: C.text }}>{row.name}</span>
                  {overlap && (
                    <span style={{
                      fontSize: 9, padding: "1px 5px", borderRadius: 2,
                      background: C.accent3 + "22", color: C.accent3,
                      border: `1px solid ${C.accent3}44`, letterSpacing: "0.07em",
                      whiteSpace: "nowrap",
                    }}>IN BOTH</span>
                  )}
                </div>

                <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 12, color: C.textDim, textAlign: "right" }}>
                  {row.nFirms}
                </span>

                <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                  <div style={{ flex: 1, background: C.border, borderRadius: 2, height: 5 }}>
                    <div style={{ width: `${(row.pct / maxPct) * 100}%`, height: "100%", background: col, borderRadius: 2 }} />
                  </div>
                  <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.textDim, width: 36, textAlign: "right" }}>
                    {fmt(row.pct)}%
                  </span>
                </div>

                <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                  <div style={{ flex: 1, background: C.border, borderRadius: 2, height: 5 }}>
                    <div style={{
                      width: `${Math.max(0, (row.ret / maxRet)) * 100}%`, height: "100%",
                      background: retColor, borderRadius: 2,
                    }} />
                  </div>
                  <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: retColor, width: 42, textAlign: "right" }}>
                    {fmt(row.ret, 2)}%
                  </span>
                </div>

                <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.textDim, textAlign: "right" }}>
                  ${fmt(row.me, 0)}M
                </span>
              </div>
            );
          })}

          </div>
          <Callout color={C.accent3}>
            Five industries appear in both Q5 and Q1 â€” same sector, different R&D intensity.
            Within-industry return comparisons:{" "}
            <strong style={{ color: C.text }}>Business Services (73):</strong> Q5 3.66%/mo vs Q1 0.90%.{" "}
            <strong style={{ color: C.text }}>Electronics (36):</strong> Q5 2.64%/mo vs Q1 0.64%.{" "}
            <strong style={{ color: C.text }}>Machinery/Computers (35):</strong> Q5 1.89%/mo vs Q1 âˆ’0.05%.{" "}
            <strong style={{ color: C.text }}>Chemicals (28):</strong> Q5 3.99%/mo vs Q1 0.80%.{" "}
            <strong style={{ color: C.text }}>Rubber/Plastics (30):</strong> Q5 2.17%/mo vs Q1 0.88%.
          </Callout>
        </div>
      );
    }

    // â”€â”€â”€ SECTION 6: PERIOD COMPARISON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function StatCard({ label, val1, val2, format, highlight }) {
      const fmtFn = format || (v => v);
      const diff   = val2 - val1;
      const up     = diff > 0;
      const diffStr = `${up ? "+" : ""}${fmtFn(diff)}`;

      return (
        <div style={{
          background: C.card,
          border: `1px solid ${highlight ? C.accent1 + "55" : C.border}`,
          borderRadius: 8, padding: 18,
        }}>
          <div style={{ fontSize: 10, color: C.muted, letterSpacing: "0.1em", textTransform: "uppercase", fontFamily: "'DM Mono', monospace", marginBottom: 14 }}>
            {label}
          </div>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 }}>
            {[["1980â€“2000", val1, C.accent1], ["2001â€“2022", val2, C.accent2]].map(([p, v, c]) => (
              <div key={p}>
                <div style={{ fontSize: 10, color: C.muted, marginBottom: 5 }}>{p}</div>
                <div style={{ fontFamily: "'DM Mono', monospace", fontSize: 20, fontWeight: 700, color: c }}>
                  {fmtFn(v)}
                </div>
              </div>
            ))}
          </div>
          <div style={{ marginTop: 10, fontSize: 11, color: up ? C.accent3 : "#5dba7a", fontFamily: "'DM Mono', monospace" }}>
            {up ? "â–²" : "â–¼"} {diffStr} vs prior period
          </div>
        </div>
      );
    }

    function PeriodSection() {
      const p1 = PERIOD_STATS["1980â€“2000"];
      const p2 = PERIOD_STATS["2001â€“2022"];

      return (
        <div>
          <SectionTitle n={6} label="Q5 Portfolio Characteristics: Period Comparison"
            sub="Key metrics for the Q5 (high R&D) portfolio across both subperiods. All Firms sample." />

          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(200px, 1fr))", gap: 16, marginBottom: 20 }}>
            <StatCard label="Unique Firms"        val1={p1.nFirms}    val2={p2.nFirms}    format={v => Math.round(v).toLocaleString()} />
            <StatCard label="Median Market Cap"   val1={p1.medianME}  val2={p2.medianME}  format={v => `$${fmt(v, 1)}M`}  highlight />
            <StatCard label="% Micro-Cap (<$50M)" val1={p1.pctMicro}  val2={p2.pctMicro}  format={v => `${fmt(v, 1)}%`}  highlight />
            <StatCard label="Mean Market Cap"     val1={p1.meanME}    val2={p2.meanME}    format={v => `$${fmt(v, 1)}M`} />
            <StatCard label="Avg Monthly Return"  val1={p1.avgRet}    val2={p2.avgRet}    format={v => `${fmt(v, 2)}%`}  highlight />
          </div>

          {/* Top industries */}
          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(320px, 1fr))", gap: 16, marginBottom: 20 }}>
            {[["1980â€“2000", p1, C.accent1], ["2001â€“2022", p2, C.accent2]].map(([pname, pd, col]) => (
              <div key={pname} style={{ background: C.card, border: `1px solid ${C.border}`, borderRadius: 8, padding: 16 }}>
                <div style={{ fontSize: 10, color: col, letterSpacing: "0.1em", textTransform: "uppercase", fontFamily: "'DM Mono', monospace", marginBottom: 14 }}>
                  {pname} â€” Top Industries
                </div>
                {pd.topInds.map((ind, i) => (
                  <div key={i} style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 10 }}>
                    <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.muted, width: 14 }}>{i + 1}.</span>
                    <div style={{ flex: 1, background: C.border, borderRadius: 2, height: 5 }}>
                      <div style={{ width: `${(ind.n / 1800) * 100}%`, height: "100%", background: col, borderRadius: 2, opacity: 1 - i * 0.2 }} />
                    </div>
                    <span style={{ fontSize: 12, color: C.text, width: 140 }}>{ind.name}</span>
                    <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.muted }}>({ind.n})</span>
                  </div>
                ))}
              </div>
            ))}
          </div>

          {/* Data summary */}
          <div style={{
            padding: "16px 20px",
            background: C.card,
            border: `1px solid ${C.border}`, borderRadius: 8,
            fontSize: 13, color: C.textDim, lineHeight: 1.8,
            fontFamily: "'DM Mono', monospace",
          }}>
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
              <div>
                <div style={{ fontSize: 9, color: C.muted, letterSpacing: "0.1em", textTransform: "uppercase", marginBottom: 8 }}>1980â€“2000</div>
                <div style={{ fontSize: 12, lineHeight: 2 }}>
                  <div>Median ME: <span style={{ color: C.accent1 }}>$25.2M</span></div>
                  <div>Mean ME: <span style={{ color: C.accent1 }}>$439.7M</span></div>
                  <div>Micro-cap (&lt;$50M): <span style={{ color: C.accent1 }}>64.6%</span></div>
                  <div>Avg monthly return: <span style={{ color: C.accent1 }}>2.70%</span></div>
                  <div>Unique firms: <span style={{ color: C.accent1 }}>2,112</span></div>
                </div>
              </div>
              <div>
                <div style={{ fontSize: 9, color: C.muted, letterSpacing: "0.1em", textTransform: "uppercase", marginBottom: 8 }}>2001â€“2022</div>
                <div style={{ fontSize: 12, lineHeight: 2 }}>
                  <div>Median ME: <span style={{ color: C.accent2 }}>$69.4M</span></div>
                  <div>Mean ME: <span style={{ color: C.accent2 }}>$667.1M</span></div>
                  <div>Micro-cap (&lt;$50M): <span style={{ color: C.accent2 }}>42.8%</span></div>
                  <div>Avg monthly return: <span style={{ color: C.accent2 }}>1.75%</span></div>
                  <div>Unique firms: <span style={{ color: C.accent2 }}>1,966</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // â”€â”€â”€ REGRESSION SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function sig(p) {
      if (p < 0.01) return { label: "***", color: "#5dba7a" };
      if (p < 0.05) return { label: "**",  color: "#8fbf6a" };
      if (p < 0.10) return { label: "*",   color: C.accent1 };
      return { label: "",  color: C.muted };
    }

    function AlphaBar({ alpha, maxAlpha }) {
      const pos = alpha >= 0;
      const pct = Math.min(Math.abs(alpha) / maxAlpha * 100, 100);
      return (
        <div style={{ display: "flex", alignItems: "center", height: 20, gap: 4 }}>
          {/* negative side */}
          <div style={{ width: "50%", display: "flex", justifyContent: "flex-end" }}>
            {!pos && (
              <div style={{
                width: `${pct}%`, height: 12, borderRadius: "2px 0 0 2px",
                background: C.accent3, opacity: 0.85,
              }} />
            )}
          </div>
          {/* centre line */}
          <div style={{ width: 1, height: 18, background: C.border, flexShrink: 0 }} />
          {/* positive side */}
          <div style={{ width: "50%" }}>
            {pos && (
              <div style={{
                width: `${pct}%`, height: 12, borderRadius: "0 2px 2px 0",
                background: C.accent1, opacity: 0.85,
              }} />
            )}
          </div>
        </div>
      );
    }

    function RegRow({ portfolio, row, model, maxAlpha }) {
      const s = sig(row.p);
      const alphaColor = row.alpha > 0 ? C.accent1 : C.accent3;
      return (
        <div style={{
          display: "grid",
          gridTemplateColumns: model === "FF3"
            ? "90px 80px 60px 60px 60px 60px 60px 50px"
            : "90px 80px 60px 60px 60px 50px",
          gap: 8, padding: "11px 0",
          borderBottom: `1px solid ${C.border}22`,
          alignItems: "center",
          fontSize: 12,
        }}>
          <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.textDim }}>
            {portfolio}
          </span>
          {/* Alpha + significance */}
          <div style={{ display: "flex", alignItems: "center", gap: 5 }}>
            <span style={{ fontFamily: "'DM Mono', monospace", fontWeight: 700, color: alphaColor }}>
              {row.alpha >= 0 ? "+" : ""}{fmt(row.alpha, 4)}%
            </span>
            <span style={{ fontSize: 11, fontWeight: 700, color: s.color }}>{s.label}</span>
          </div>
          {/* t-stat */}
          <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11,
            color: Math.abs(row.t) > 2 ? C.text : C.muted }}>
            ({fmt(row.t, 2)})
          </span>
          {/* Sharpe */}
          <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.textDim }}>
            {fmt(row.sharpe, 2)}
          </span>
          {/* Alpha bar */}
          
          {/* Î² Mkt */}
          <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.muted }}>
            {fmt(row.betaMkt, 3)}
          </span>
          {/* Î² SMB / Î² HML (FF3 only) */}
          {model === "FF3" && <>
            <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.muted }}>
              {fmt(row.betaSmb, 3)}
            </span>
            <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.muted }}>
              {fmt(row.betaHml, 3)}
            </span>
          </>}
          {/* RÂ² */}
          <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.muted }}>
            {fmt(row.r2, 3)}
          </span>
        </div>
      );
    }

    function RegTableHeader({ model }) {
      const cols = model === "FF3"
        ? "90px 80px 60px 60px 60px 60px 60px 50px"
        : "90px 80px 60px 60px 60px 50px";
      return (
        <div style={{
          display: "grid", gridTemplateColumns: cols,
          gap: 8, paddingBottom: 8, marginBottom: 2,
          borderBottom: `1px solid ${C.border}`,
          fontSize: 9, color: C.muted, letterSpacing: "0.1em",
          textTransform: "uppercase", fontFamily: "'DM Mono', monospace",
        }}>
          <span>Portfolio</span>
          <span>Alpha /mo</span>
          <span>(t-stat)</span>
          <span>Sharpe</span>
          
          <span>Î² Mkt</span>
          {model === "FF3" && <><span>Î² SMB</span><span>Î² HML</span></>}
          <span>RÂ²</span>
        </div>
      );
    }

    function RegressionSection() {
      const [weighting, setWeighting] = useState("EW");
      const [model,     setModel]     = useState("CAPM");
      const [sample,    setSample]    = useState("all");

      // Lookup both periods for side-by-side display
      const sampleKey = sample === "all" ? "all" : "filtered";
      const data80  = REGS[sampleKey][weighting][model]["1980â€“2000"];
      const data01  = REGS[sampleKey][weighting][model]["2001â€“2022"];

      const allAlphas = [
        ...Object.values(data80).map(r => Math.abs(r.alpha)),
        ...Object.values(data01).map(r => Math.abs(r.alpha)),
      ];
      const maxAlpha = Math.max(...allAlphas) * 1.1;

      const filterBtn = (opts, val, setVal) => (
        <div style={{ display: "flex", gap: 6 }}>
          {opts.map(([v, lbl, col]) => {
            const active = val === v;
            const c = col || C.accent1;
            return (
              <button key={v} onClick={() => setVal(v)} style={{
                padding: "5px 14px", borderRadius: 4, fontSize: 11, fontWeight: 600,
                cursor: "pointer", border: "1px solid",
                borderColor: active ? c : C.border,
                background: active ? c + "20" : "transparent",
                color: active ? c : C.textDim,
                letterSpacing: "0.04em",
              }}>{lbl}</button>
            );
          })}
        </div>
      );

      // Compute alpha change for callout
      const q51_old = data80["Q5-Q1"].alpha;
      const q51_new = data01["Q5-Q1"].alpha;
      const q5z_old = data80["Q5-Zero"].alpha;
      const q5z_new = data01["Q5-Zero"].alpha;

      return (
        <div>
          <SectionTitle n={1} label="Regression Results Explorer"
            sub="Filter across all 32 regressions â€” weighting, model, sample, both subperiods side by side." />

          {/* Filter bar */}
          <div style={{
            background: C.card, border: `1px solid ${C.border}`,
            borderRadius: 8, padding: "16px 20px", marginBottom: 24,
          }}>
            <div style={{ display: "flex", gap: 24, flexWrap: "wrap", alignItems: "center" }}>
              <div>
                <div style={{ fontSize: 9, color: C.muted, letterSpacing: "0.1em", textTransform: "uppercase", fontFamily: "'DM Mono', monospace", marginBottom: 7 }}>Weighting</div>
                {filterBtn([["EW","Equal-Weight",C.accent1],["VW","Value-Weight",C.accent2]], weighting, setWeighting)}
              </div>
              <div style={{ width: 1, height: 36, background: C.border }} />
              <div>
                <div style={{ fontSize: 9, color: C.muted, letterSpacing: "0.1em", textTransform: "uppercase", fontFamily: "'DM Mono', monospace", marginBottom: 7 }}>Model</div>
                {filterBtn([["CAPM","CAPM",C.accent1],["FF3","Fama-French 3F",C.accent2]], model, setModel)}
              </div>
              <div style={{ width: 1, height: 36, background: C.border }} />
              <div>
                <div style={{ fontSize: 9, color: C.muted, letterSpacing: "0.1em", textTransform: "uppercase", fontFamily: "'DM Mono', monospace", marginBottom: 7 }}>Sample</div>
                {filterBtn([["all","All Firms",C.accent1],["filtered","Filtered (>$100M, Ex-Top100)",C.accent3]], sample, setSample)}
              </div>
            </div>
          </div>

          {/* Side-by-side periods */}
          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(320px, 1fr))", gap: 16, marginBottom: 20 }}>
            {[["1980â€“2000", data80, C.accent1], ["2001â€“2022", data01, C.accent2]].map(([period, data, col]) => (
              <div key={period} style={{
                background: C.card, border: `1px solid ${col}33`,
                borderRadius: 8, padding: "18px 20px",
              }}>
                {/* Period header */}
                <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 16 }}>
                  <div style={{ width: 3, height: 18, background: col, borderRadius: 2 }} />
                  <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: col, letterSpacing: "0.12em" }}>
                    {period}
                  </span>
                  <span style={{ fontSize: 11, color: C.muted }}>
                    Â· {weighting} Â· {model} Â· {sample === "all" ? "All Firms" : "Filtered"}
                  </span>
                </div>

                <div style={{ overflowX: "auto" }}>
                <RegTableHeader model={model} />
                {["Q5-Q1", "Q5-Zero"].map(port => (
                  <RegRow key={port} portfolio={port} row={data[port]} model={model} maxAlpha={maxAlpha} />
                ))}
                </div>

                {/* Significance key */}
                <div style={{ marginTop: 12, display: "flex", gap: 12 }}>
                  {[["***","p<0.01","#5dba7a"],["**","p<0.05","#8fbf6a"],["*","p<0.10",C.accent1],["","n.s.",C.muted]].map(([sym, lbl, c]) => (
                    <div key={lbl} style={{ display: "flex", alignItems: "center", gap: 4 }}>
                      <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 10, fontWeight: 700, color: c, width: 16 }}>{sym || "â€”"}</span>
                      <span style={{ fontSize: 10, color: C.muted }}>{lbl}</span>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>

          {/* Factual summary callout â€” just the numbers */}
          <div style={{
            padding: "14px 20px",
            background: C.card, border: `1px solid ${C.border}`,
            borderRadius: 8, fontSize: 12, color: C.textDim, lineHeight: 1.8,
            fontFamily: "'DM Mono', monospace",
          }}>
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
              <div>
                <div style={{ fontSize: 9, color: C.muted, letterSpacing: "0.1em", textTransform: "uppercase", marginBottom: 8 }}>1980â€“2000</div>
                <div>Q5-Q1 Î±: <span style={{ color: data80["Q5-Q1"].alpha > 0 ? C.accent1 : C.accent3, fontWeight: 700 }}>
                  {data80["Q5-Q1"].alpha >= 0 ? "+" : ""}{fmt(data80["Q5-Q1"].alpha, 4)}%
                </span>{" "}(t={fmt(data80["Q5-Q1"].t, 2)}, p={fmt(data80["Q5-Q1"].p, 4)})</div>
                <div>Q5-Zero Î±: <span style={{ color: data80["Q5-Zero"].alpha > 0 ? C.accent1 : C.accent3, fontWeight: 700 }}>
                  {data80["Q5-Zero"].alpha >= 0 ? "+" : ""}{fmt(data80["Q5-Zero"].alpha, 4)}%
                </span>{" "}(t={fmt(data80["Q5-Zero"].t, 2)}, p={fmt(data80["Q5-Zero"].p, 4)})</div>
              </div>
              <div>
                <div style={{ fontSize: 9, color: C.muted, letterSpacing: "0.1em", textTransform: "uppercase", marginBottom: 8 }}>2001â€“2022</div>
                <div>Q5-Q1 Î±: <span style={{ color: data01["Q5-Q1"].alpha > 0 ? C.accent2 : C.accent3, fontWeight: 700 }}>
                  {data01["Q5-Q1"].alpha >= 0 ? "+" : ""}{fmt(data01["Q5-Q1"].alpha, 4)}%
                </span>{" "}(t={fmt(data01["Q5-Q1"].t, 2)}, p={fmt(data01["Q5-Q1"].p, 4)})</div>
                <div>Q5-Zero Î±: <span style={{ color: data01["Q5-Zero"].alpha > 0 ? C.accent2 : C.accent3, fontWeight: 700 }}>
                  {data01["Q5-Zero"].alpha >= 0 ? "+" : ""}{fmt(data01["Q5-Zero"].alpha, 4)}%
                </span>{" "}(t={fmt(data01["Q5-Zero"].t, 2)}, p={fmt(data01["Q5-Zero"].p, 4)})</div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // â”€â”€â”€ EXECUTIVE SUMMARY & METHODOLOGY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function MethodologyTimeline() {
      const steps = [
        { n: "01", title: "Binary Portfolios", desc: "Split firms into R&D vs No R&D. Multiple rounds of data reconciliation to align team approaches.", accent: C.accent1 },
        { n: "02", title: "Weighted R&D Signal", desc: "Created a multi-year weighted measure: XRD_t + 0.8Â·XRD_{t-1} + 0.6Â·XRD_{t-2} + 0.4Â·XRD_{t-3} + 0.2Â·XRD_{t-4}, capturing lasting R&D effects.", accent: C.accent2 },
        { n: "03", title: "Size Normalization", desc: "Each year's R&D is divided by that same year's market cap before applying the decay weights â€” so the signal is R&D intensity at every lag, not raw dollars.", accent: C.accent3 },
        { n: "04", title: "Quintile Sorts & L/S", desc: "Sorted into 5 portfolios (Q1â€“Q5). Built long-short portfolios: Q5âˆ’Q1 and Q5âˆ’Zero R&D.", accent: "#5dba7a" },
      ];
      return (
        <div style={{ position: "relative", paddingLeft: 28 }}>
          <div style={{ position: "absolute", left: 11, top: 8, bottom: 8, width: 2, background: `linear-gradient(180deg, ${C.accent1}, ${C.accent2}, ${C.accent3}, #5dba7a)`, borderRadius: 1, zIndex: 0 }} />
          {steps.map((s, i) => (
            <div key={s.n} style={{ display: "flex", gap: 16, marginBottom: i < steps.length - 1 ? 24 : 0, position: "relative" }}>
              <div style={{
                width: 22, height: 22, borderRadius: "50%", background: C.card,
                border: `2px solid ${s.accent}`, display: "flex", alignItems: "center", justifyContent: "center",
                position: "absolute", left: -28, top: 2, zIndex: 1,
              }}>
                <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 8, color: s.accent, fontWeight: 700 }}>{s.n}</span>
              </div>
              <div>
                <div style={{ fontSize: 14, fontWeight: 600, color: C.text, marginBottom: 4 }}>{s.title}</div>
                <div style={{ fontSize: 12, color: C.textDim, lineHeight: 1.65 }}>{s.desc}</div>
              </div>
            </div>
          ))}
        </div>
      );
    }

    function InsightCard({ icon, title, body, accent }) {
      return (
        <div style={{
          background: C.card, border: `1px solid ${accent}33`, borderRadius: 8,
          padding: "18px 20px", flex: 1, minWidth: 200,
        }}>
          <div style={{ fontSize: 20, marginBottom: 8 }}>{icon}</div>
          <div style={{ fontSize: 13, fontWeight: 600, color: accent, marginBottom: 6 }}>{title}</div>
          <div style={{ fontSize: 12, color: C.textDim, lineHeight: 1.7 }}>{body}</div>
        </div>
      );
    }

    function FormulaBlock() {
      return (
        <div style={{
          background: C.surface, border: `1px solid ${C.border}`, borderRadius: 8,
          padding: "16px 22px", fontFamily: "'DM Mono', monospace", fontSize: 13,
          color: C.accent2, textAlign: "center", letterSpacing: "0.02em", lineHeight: 2,
          overflowX: "auto",
        }}>
          <span style={{ color: C.muted, fontSize: 10, display: "block", marginBottom: 6, letterSpacing: "0.12em", textTransform: "uppercase" }}>Weighted R&D Intensity Signal</span>
          XRD<sub>t</sub>/ME<sub>t</sub> + 0.8Â·XRD<sub>tâˆ’1</sub>/ME<sub>tâˆ’1</sub> + 0.6Â·XRD<sub>tâˆ’2</sub>/ME<sub>tâˆ’2</sub> + 0.4Â·XRD<sub>tâˆ’3</sub>/ME<sub>tâˆ’3</sub> + 0.2Â·XRD<sub>tâˆ’4</sub>/ME<sub>tâˆ’4</sub>
          <div style={{ color: C.muted, fontSize: 10, marginTop: 6, letterSpacing: "0.05em" }}>
            Each year's R&D is scaled by that year's market cap before weighting
          </div>
        </div>
      );
    }

    function AlphaDecayViz() {
      const bars = [
        { label: "1980â€“2000", sub: "EW Â· All Firms Â· FF3", alpha: 2.02, t: 6.08, sig: true, color: C.accent1 },
        { label: "2001â€“2022", sub: "EW Â· All Firms Â· FF3", alpha: 0.76, t: 2.20, sig: true, color: C.accent2 },
        { label: "1980â€“2000", sub: "VW Â· All Firms Â· FF3", alpha: 0.07, t: 0.21, sig: false, color: C.accent1 },
        { label: "2001â€“2022", sub: "VW Â· All Firms Â· FF3", alpha: -0.06, t: -0.17, sig: false, color: C.accent2 },
      ];
      const maxAlpha = 2.2;
      return (
        <div>
          <div style={{ fontSize: 10, color: C.muted, letterSpacing: "0.1em", textTransform: "uppercase", fontFamily: "'DM Mono', monospace", marginBottom: 14 }}>
            Q5âˆ’Q1 Alpha Decay (Monthly %)
          </div>
          {bars.map((b, i) => (
            <div key={i} style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 10 }}>
              <div style={{ width: 150, flexShrink: 0 }}>
                <div style={{ fontSize: 11, color: b.color, fontWeight: 600 }}>{b.label}</div>
                <div style={{ fontSize: 9, color: C.muted }}>{b.sub}</div>
              </div>
              <div style={{ flex: 1, background: C.border, borderRadius: 3, height: 20, position: "relative", overflow: "hidden" }}>
                {b.alpha > 0 && <div style={{
                  width: `${(b.alpha / maxAlpha) * 100}%`, height: "100%",
                  background: b.sig ? b.color : b.color + "44", borderRadius: 3,
                }} />}
              </div>
              <span style={{
                fontFamily: "'DM Mono', monospace", fontSize: 13, fontWeight: 700,
                color: b.sig ? b.color : C.muted, width: 65, textAlign: "right",
              }}>
                {b.alpha >= 0 ? "+" : ""}{b.alpha.toFixed(2)}%
              </span>
              <span style={{
                fontFamily: "'DM Mono', monospace", fontSize: 10,
                color: b.sig ? "#5dba7a" : C.muted, width: 20,
              }}>
                {b.sig ? "âœ“" : "â€”"}
              </span>
            </div>
          ))}
        </div>
      );
    }

    function ExecutiveSummary() {
      return (
        <div style={{ marginBottom: 72 }}>
          {/* Section heading */}
          <div style={{ marginBottom: 28 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 6 }}>
              <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 11, color: C.accent1, letterSpacing: "0.15em" }}>
                00
              </span>
              <div style={{ flex: 1, height: 1, background: C.border }} />
            </div>
            <h2 style={{ fontFamily: "'Playfair Display', serif", fontSize: 22, color: C.text, margin: 0, fontWeight: 700 }}>
              Executive Summary & Methodology
            </h2>
            <p style={{ color: C.textDim, fontSize: 13, margin: "6px 0 0", lineHeight: 1.6 }}>
              Can R&D spending predict stock returns? We tested this from binary sorts through quintile long-short portfolios spanning 1980â€“2022.
            </p>
          </div>

          {/* The Big Finding â€” hero callout */}
          <div style={{
            background: `linear-gradient(135deg, ${C.accent1}11, ${C.accent3}11)`,
            border: `1px solid ${C.accent1}44`, borderRadius: 10,
            padding: "24px 28px", marginBottom: 28,
          }}>
            <div style={{ fontSize: 10, letterSpacing: "0.15em", color: C.accent1, textTransform: "uppercase", fontFamily: "'DM Mono', monospace", marginBottom: 10 }}>
              Core Finding
            </div>
            <div style={{ fontSize: 16, color: C.text, lineHeight: 1.7, fontWeight: 500 }}>
              R&D intensity generated <span style={{ color: C.accent1, fontWeight: 700 }}>significant long-short alpha in 1980â€“2000</span>, 
              particularly in equal-weighted portfolios. By 2001â€“2022, most of this alpha <span style={{ color: C.accent3, fontWeight: 700 }}>decayed or disappeared</span> â€” 
              consistent with improved pricing of intangible assets after Reg FD (2000) and broader market efficiency gains.
            </div>
          </div>

          {/* Three insight cards */}
          <div style={{ display: "flex", gap: 16, marginBottom: 28, flexWrap: "wrap" }}>
            <InsightCard
              icon="ðŸ“"
              title="Small-Cap Driven"
              body="Alpha appears almost exclusively in equal-weighted portfolios, suggesting the R&D mispricing effect is concentrated in smaller firms where information asymmetry is greatest."
              accent={C.accent1}
            />
            <InsightCard
              icon="ðŸ“‰"
              title="Alpha Decay Post-2000"
              body="Reg FD (2000) improved R&D disclosure. The market now prices intangible assets more efficiently, eroding the historical edge from R&D screening."
              accent={C.accent2}
            />
            <InsightCard
              icon="âš–ï¸"
              title="Size Normalization Matters"
              body="Raw XRD proxied for firm size. By dividing each year's R&D by that year's market cap before applying decay weights, every lag becomes R&D intensity rather than raw dollars."
              accent={C.accent3}
            />
          </div>

          {/* Two-column: Methodology timeline + Formula + Alpha viz */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 24, marginBottom: 28 }}>
            {/* Left: methodology */}
            <div style={{ background: C.card, border: `1px solid ${C.border}`, borderRadius: 8, padding: "22px 24px" }}>
              <div style={{ fontSize: 10, color: C.accent1, letterSpacing: "0.12em", textTransform: "uppercase", fontFamily: "'DM Mono', monospace", marginBottom: 18 }}>
                Methodology Pipeline
              </div>
              <MethodologyTimeline />
            </div>

            {/* Right: formula + alpha decay */}
            <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
              <FormulaBlock />
              <div style={{ background: C.card, border: `1px solid ${C.border}`, borderRadius: 8, padding: "18px 22px", flex: 1 }}>
                <AlphaDecayViz />
              </div>
            </div>
          </div>

          {/* Test matrix â€” what was tested */}
          <div style={{ background: C.card, border: `1px solid ${C.border}`, borderRadius: 8, padding: "18px 22px", marginBottom: 28 }}>
            <div style={{ fontSize: 10, color: C.accent2, letterSpacing: "0.12em", textTransform: "uppercase", fontFamily: "'DM Mono', monospace", marginBottom: 14 }}>
              Test Matrix
            </div>
            <div style={{ display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: 16 }}>
              {[
                { label: "Benchmarks", items: ["CAPM", "Fama-French 3F"] },
                { label: "Weightings", items: ["Equal-Weighted", "Value-Weighted"] },
                { label: "Periods", items: ["1980â€“2000", "2001â€“2022"] },
                { label: "Samples", items: ["All Firms", "ME > $100M"] },
              ].map(g => (
                <div key={g.label}>
                  <div style={{ fontSize: 10, color: C.muted, letterSpacing: "0.08em", textTransform: "uppercase", fontFamily: "'DM Mono', monospace", marginBottom: 8 }}>{g.label}</div>
                  {g.items.map(item => (
                    <div key={item} style={{
                      fontSize: 12, color: C.text, padding: "5px 10px", marginBottom: 4,
                      background: C.surface, borderRadius: 4, border: `1px solid ${C.border}`,
                    }}>{item}</div>
                  ))}
                </div>
              ))}
            </div>
          </div>

          {/* Where significant alphas were found */}
          <div style={{
            background: C.card, border: `1px solid ${C.accent1}33`, borderRadius: 8,
            padding: "18px 22px",
          }}>
            <div style={{ fontSize: 10, color: C.accent1, letterSpacing: "0.12em", textTransform: "uppercase", fontFamily: "'DM Mono', monospace", marginBottom: 14 }}>
              Where Significant Alphas Were Found
            </div>
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
              {[
                { cond: "EW Â· All Firms Â· 1980â€“2000", note: "Both Q5âˆ’Q1 and Q5âˆ’Zero (CAPM & FF3)", strong: true },
                { cond: "EW Â· All Firms Â· 2001â€“2022", note: "Q5âˆ’Q1 only (CAPM & FF3)", strong: false },
                { cond: "EW Â· Filtered Â· 1980â€“2000", note: "Q5âˆ’Q1 (CAPM & FF3), Q5âˆ’Zero (FF3)", strong: true },
                { cond: "VW Â· Filtered Â· 1980â€“2000", note: "Q5âˆ’Zero FF3 only", strong: false },
              ].map((r, i) => (
                <div key={i} style={{
                  padding: "10px 14px", borderRadius: 6,
                  background: r.strong ? C.accent1 + "11" : C.surface,
                  border: `1px solid ${r.strong ? C.accent1 + "33" : C.border}`,
                }}>
                  <div style={{ fontSize: 12, fontWeight: 600, color: r.strong ? C.accent1 : C.textDim, marginBottom: 3 }}>{r.cond}</div>
                  <div style={{ fontSize: 11, color: C.muted }}>{r.note}</div>
                </div>
              ))}
            </div>
            <div style={{ fontSize: 12, color: C.textDim, lineHeight: 1.7, marginTop: 14, padding: "12px 0 0", borderTop: `1px solid ${C.border}` }}>
              <strong style={{ color: C.text }}>Bottom line:</strong> R&D intensity was a viable alpha signal historically, but improved disclosure (Reg FD) and better intangible-asset pricing have diminished its edge. Future work could explore sector-specific universes or exclude mega-caps to isolate pockets of remaining mispricing.
            </div>
          </div>
        </div>
      );
    }

    // â”€â”€â”€ APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function App() {
      return (
        <div style={{ background: C.bg, minHeight: "100vh" }}>
          {/* Header */}
          <div style={{
            padding: "32px clamp(16px, 4vw, 48px) 24px",
            borderBottom: `1px solid ${C.border}`,
            background: `linear-gradient(180deg, ${C.surface} 0%, ${C.bg} 100%)`,
          }}>
            <div style={{ maxWidth: 960, margin: "0 auto", display: "flex", alignItems: "flex-start", gap: 24, flexWrap: "wrap" }}>
              <div style={{ flex: 1 }}>
                <div style={{ fontSize: 10, letterSpacing: "0.2em", color: C.accent1, fontFamily: "'DM Mono', monospace", marginBottom: 10, textTransform: "uppercase" }}>
                  R&D Portfolio Analysis Â· Key Findings
                </div>
                <h1 style={{ fontFamily: "'Playfair Display', serif", fontSize: 32, margin: 0, fontWeight: 700, color: C.text, lineHeight: 1.2 }}>
                  R&D Portfolio Analysis<br />
                  <span style={{ color: C.accent1 }}>1980â€“2022</span>
                </h1>
                <p style={{ color: C.textDim, fontSize: 13, marginTop: 10, lineHeight: 1.7, maxWidth: 520 }}>
                  CRSP / Compustat. Portfolios sorted annually each July on R&D intensity.
                  Two samples (all firms; filtered ME &gt;$100M, ex-top 100), two weightings (EW/VW),
                  two models (CAPM / FF3), two subperiods (1980â€“2000 / 2001â€“2022).
                </p>
              </div>
              <div style={{ display: "flex", flexDirection: "column", gap: 8, paddingTop: 6 }}>
                {[["00","Executive Summary"],["01","Regression Results"],["02","Size Distribution"],["03","Industry Breakdown"],["06","Period Comparison"]].map(([n, lbl]) => (
                  <div key={n} style={{ display: "flex", alignItems: "center", gap: 8 }}>
                    <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 10, color: C.accent1 }}>Â§{n}</span>
                    <span style={{ fontSize: 12, color: C.textDim }}>{lbl}</span>
                  </div>
                ))}
              </div>
            </div>
          </div>

          {/* Body */}
          <div style={{ maxWidth: 960, margin: "0 auto", padding: "36px clamp(16px, 4vw, 48px) 80px" }}>
            <div style={{ marginBottom: 72 }}><ExecutiveSummary /></div>
            <div style={{ height: 1, background: C.border, marginBottom: 72 }} />
            <div style={{ marginBottom: 72 }}><RegressionSection /></div>
            <div style={{ height: 1, background: C.border, marginBottom: 72 }} />
            <div style={{ marginBottom: 72 }}><SizeSection /></div>
            <div style={{ height: 1, background: C.border, marginBottom: 72 }} />
            <div style={{ marginBottom: 72 }}><SICSection /></div>
            <div style={{ height: 1, background: C.border, marginBottom: 72 }} />
            <PeriodSection />
          </div>

          {/* Footer */}
          <div style={{ borderTop: `1px solid ${C.border}`, padding: "20px clamp(16px, 4vw, 48px)", textAlign: "center" }}>
            <span style={{ fontFamily: "'DM Mono', monospace", fontSize: 10, color: C.muted, letterSpacing: "0.1em" }}>
              DATA: CRSP / COMPUSTAT / WRDS Â· SAMPLE: NYSE, AMEX, NASDAQ 1980â€“2022 Â· PORTFOLIOS SORTED ANNUALLY EACH JULY
            </span>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
